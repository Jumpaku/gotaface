# gf-dbinit

gf-dbinit is a command-line tool designed to simplify table initialization. It supports drivers for Spanner and SQLite3 and provides a standardized interface for deleting existing data and inserting new rows. By utilizing a JSON-based input format and providing consistent functionality across data sources, it simplifies the task of defining and managing the data to be inserted.

## Usage

```sh
gf-dbinit [-schema <schema-json>] <driver> <data-source>
gf-dbinit -h | --help
```

gf-dbinit is a command-line tool used to initialize tables in a data source. It supports the following drivers:

- Spanner
- SQLite3

To use gf-dbinit with Spanner, specify `spanner` as the `<driver>` and provide a string in the format `projects/<project>/instances/<instance>/databases/<database>` as the `<data-source>`. In this format, `<project>` represents the name of your Google Cloud Platform (GCP) project, `<instance>` is the name of your Spanner instance in the GCP project, and `<database>` is the name of the database within the Spanner instance.

To use gf-dbinit with SQLite3, set `sqlite3` as the `<driver>` and provide a connection string as the `<data-source>`.
The connection string should follow the format described in [https://github.com/mattn/go-sqlite3#connection-string](https://github.com/mattn/go-sqlite3#connection-string), such as `file:test.db?cache=shared&mode=memory`.

gf-dbinit fetches schema information to prepare for the initialization. To provide specific JSON-based schema file, specify the path `<schema-json>` of the file using `-schema` option.

## Input

gf-dbinit expects a JSON array as input from stdin. The JSON array should have the following structure:

```ts
type InitializedTables = []{
        "name": string, // name of a table to be initialized.
        "rows": []Row   // rows inserted into the table after deletion.
}
type Row = { 
    // mapping from column name to column value in a row
    [column: string]: ColumnValue
}
// column value in a row can take the following types
type ColumnValue = null | number | boolean | string
```

Here's an example:
```json
[
    {
        "name": "User",
        "rows": [
            { "id": 1, "name": "Jumpaku", "isGuest": false},
            { "id": 2, "name": null, "isGuest": true}
        ]
    }, {
        "name": "Comment",
        "rows": [
            { "id": 1, "userId": 1, "content": "Hello" },
            { "id": 2, "userId": 1, "content": "Bye" }
        ]
    }
]
```

In this example, the JSON input instructs gf-dbinit to delete existing rows in the User and Comment tables and then insert the provided rows into the tables.

## Output

There is no specific output generated by gf-dbinit.